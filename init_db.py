from extensions import app, db
from models import Организация, Отдел, Сотрудник
from werkzeug.security import generate_password_hash

def init_database():
    with app.app_context():
        # Удаляем существующие данные
        db.drop_all()
        db.create_all()

        # Создаем организацию
        org = Организация(название='ООО Тест')
        db.session.add(org)
        db.session.commit()

        # Создаем отделы
        отделы = [
            Отдел(название='Отдел разработки', организация_id=org.id),
            Отдел(название='Отдел тестирования', организация_id=org.id),
            Отдел(название='Отдел аналитики', организация_id=org.id)
        ]
        for отдел in отделы:
            db.session.add(отдел)
        db.session.commit()

        # Создаем администратора
        admin = Сотрудник(
            фамилия='Администратор',
            имя='Системы',
            табельный_номер='0001',
            должность='Главный администратор',
            email='admin@example.com',
            пароль=generate_password_hash('admin123'),
            отдел_id=отделы[0].id,
            роль='администратор'
        )
        db.session.add(admin)

        # Создаем руководителя
        руководитель = Сотрудник(
            фамилия='Руководитель',
            имя='Отдела',
            табельный_номер='0002',
            должность='Начальник отдела',
            email='manager@example.com',
            пароль=generate_password_hash('manager123'),
            отдел_id=отделы[0].id,
            роль='руководитель'
        )
        db.session.add(руководитель)

        # Создаем тестовых сотрудников
        сотрудники = [
            Сотрудник(
                фамилия='Иванов',
                имя='Иван',
                отчество='Иванович',
                табельный_номер='0003',
                должность='Старший разработчик',
                email='ivan@example.com',
                пароль=generate_password_hash('user123'),
                отдел_id=отделы[0].id,
                роль='сотрудник'
            ),
            Сотрудник(
                фамилия='Петров',
                имя='Петр',
                отчество='Петрович',
                табельный_номер='0004',
                должность='Тестировщик',
                email='petr@example.com',
                пароль=generate_password_hash('user123'),
                отдел_id=отделы[1].id,
                роль='сотрудник'
            ),
            Сотрудник(
                фамилия='Сидорова',
                имя='Анна',
                отчество='Владимировна',
                табельный_номер='0005',
                должность='Бизнес-аналитик',
                email='anna@example.com',
                пароль=generate_password_hash('user123'),
                отдел_id=отделы[2].id,
                роль='сотрудник'
            )
        ]
        
        for сотрудник in сотрудники:
            db.session.add(сотрудник)
        
        db.session.commit()

        print('База данных успешно инициализирована!')
        print('\nДанные для входа администратора:')
        print('Email: admin@example.com')
        print('Пароль: admin123')
        print('\nДанные для входа руководителя:')
        print('Email: manager@example.com')
        print('Пароль: manager123')
        print('\nДанные для входа тестового пользователя:')
        print('Email: ivan@example.com')
        print('Пароль: user123')
        print('\nТабельные номера сотрудников:')
        print('0001 - Администратор Системы (администратор)')
        print('0002 - Руководитель Отдела (руководитель)')
        print('0003 - Иванов Иван Иванович (сотрудник)')
        print('0004 - Петров Петр Петрович (сотрудник)')
        print('0005 - Сидорова Анна Владимировна (сотрудник)')

if __name__ == '__main__':
    init_database()
